!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n="undefined"!=typeof globalThis?globalThis:n||self)["cytposcape-automove"]=e()}(this,(function(){"use strict";function n(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e(n)}var t={nodesMatching:function(n){return!1},reposition:"mean",when:void 0,meanIgnores:function(n){return!1},meanOnSelfPosition:function(n){return!0},dragWith:function(n){return!1}},o=null!=Object.assign?Object.assign.bind(Object):function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];return t.forEach((function(e){Object.keys(e).forEach((function(t){return n[t]=e[t]}))})),n},r=t,i=e(""),u=e({}),c=e((function(){})),f=function(n){return e(n)===u},a=function(n){return e(n)===c},s=function(n){return f(n)&&a(n.collection)},d=o,l=function(n){return null!=n&&!n.removed()},y=function(n,e){return y=null!=n.has?function(n,e){return n.has(e)}:function(n,e){return n.intersection(e).length>0},y(n,e)},h=function(n){if(e(n)===i)return function(e){return e.is(n)};if(a(n))return n;if(s(n))return function(e){return y(n,e)};throw new Error("Can not create match function for spec",n)},g=function(n,e,t,o,r){var i=function(n,e,t,o){var r={cy:n,events:e,selector:t||"node",fn:o};return n.on(r.events,r.selector,r.fn),r}(e,t,o,r);(n.bindings=n.bindings||[]).push(i)},p=function(n){n.bindings.forEach((function(n){n.cy.off(n.events,n.selector,n.fn)})),n.bindings=[]},v=function(n){return function(e){var t=e.position(),o=n.delta;if(null!=n.delta&&!e.same(n.grabbedNode)&&!e.grabbed())return{x:t.x+o.x,y:t.y+o.y}}},m=function(n){return function(e){for(var t=e.neighborhood(),o={x:0,y:0},r=0,i=0;i<t.length;i++){var u=t[i];if(u.isNode()&&!n(u)){var c=u.position();o.x+=c.x,o.y+=c.y,r++}}if(!(r<2))return o.x/=r,o.y/=r,o}},b=function(n,e,t){return n<e?e:n>t?t:n},x=function(n,e){var t=n.position();return{x:b(t.x,e.x1,e.x2),y:b(t.y,e.y1,e.y2)}},N=function(n){return function(e){return x(e,n)}},w=function(n){return function(e){return function(n,e){var t=n.position(),o=t.x,r=t.y,i=e.x1,u=e.y1,c=e.x2,f=e.y2,a=i<=o&&o<=c,s=u<=r&&r<=f,d=Math.abs;if(a&&s){var l=d(i-o),y=d(c-o),h=d(u-r),g=d(f-r),p=Math.min(l,y,h,g);return p===l?{x:i,y:r}:p===y?{x:c,y:r}:p===h?{x:o,y:u}:{x:o,y:f}}return{x:o,y:r}}(e,n)}},M=function(n){return function(e){var t=n.extent(),o=e.outerWidth(),r=e.outerHeight(),i={x1:t.x1+o/2,x2:t.x2-o/2,y1:t.y1+r/2,y2:t.y2-r/2};return x(e,i)}},O=function(n,e){return"mean"===e.reposition?function(n){return function(e,t){var o=function(e){return n.matches(e)&&e.neighborhood().length>2&&!e.grabbed()};g(n,t,"position","node",(function(){var r=this;(r.neighborhood().some(o)||n.meanOnSelfPosition(r)&&o(r))&&e(t,[n])})),g(n,t,"add remove","edge",(function(){[t.getElementById(this.data("source")),t.getElementById(this.data("target"))].some(o)&&e(t,[n])}))}}(e):"drag"===e.reposition?function(n){return function(e,t){g(n,t,"grab","node",(function(){var e=this;if(n.dragWithMatches(e)){var t=e.position();n.grabbedNode=e,n.p1={x:t.x,y:t.y},n.delta={x:0,y:0}}})),g(n,t,"drag","node",(function(){if(this.same(n.grabbedNode)){var o=n.delta,r=n.p1,i=this.position(),u={x:i.x,y:i.y};o.x=u.x-r.x,o.y=u.y-r.y,n.p1=u,e(t,[n])}})),g(n,t,"free","node",(function(){n.grabbedNode=null,n.delta=null,n.p1=null}))}}(e):f(e.reposition)||"matching"===e.when||"viewport"===e.reposition?function(n){return function(e,t){g(n,t,"position","node",(function(){n.matches(this)&&e(t,[n])}))}}(e):e.when},E=function(n,e,t){var o=d({},r,t);if(o.getNewPos=function(n,e){var t=n.reposition;return"mean"===t?m(h(n.meanIgnores)):"viewport"===t?M(e):"drag"===t?v(n):f(t)?null==t.type||"inside"==t.type?N(t):"outside"==t.type?w(t):void 0:t}(o,n),o.listener=O(0,o),s(o.nodesMatching))o.nodes=o.nodesMatching.slice(),o.matches=function(n){return l(n)&&y(o.nodes,n)};else{var i=h(o.nodesMatching);o.matches=function(n){return l(n)&&i(n)}}return null!=o.dragWith&&(o.dragWithMatches=h(o.dragWith)),o.listener((function(){j(n,[o])}),n),o.enabled=!0,e.rules.push(o),o},S=function(n,e){n.removeListener("add","node",e.onAddNode),n.removeListener("remove","node",e.onRmNode)},j=function(n,e){var t=n.scratch().automove;e=null!=e?e:t.rules,n.batch((function(){for(var n=0;n<e.length;n++){var o=e[n];if(o.destroyed||!o.enabled)break;for(var r=o.nodes||t.nodes,i=r.length-1;i>=0;i--){var u=r[i];if(u.removed())r.unmerge(u);else if(o.matches(u)){var c=u.position(),f=o.getNewPos(u);null!=f&&(c.x!==f.x||c.y!==f.y)&&(u.position(f),u.trigger("automove",[o]))}}}}))},W=function(n){var e=this,t=e.scratch().automove=e.scratch().automove||{rules:[]};if(0===t.rules.length&&(t.nodes=e.nodes().slice(),function(n,e){e.onAddNode=function(n){var t=n.target;e.nodes.merge(t)},e.onRmNode=function(n){var t=n.target;e.nodes.unmerge(t)},n.on("add","node",e.onAddNode),n.on("remove","node",e.onRmNode)}(e,t)),"destroy"===n)return t.rules.forEach((function(n){p(n),n.destroyed=!0})),t.rules.splice(0,t.rules.length),void S(e,t);var o=E(e,t,n);return j(e,[o]),{apply:function(){j(e,[o])},disable:function(){this.toggle(!1)},enable:function(){this.toggle(!0)},enabled:function(){return o.enabled},toggle:function(n){o.enabled=void 0!==n?n:!o.enabled,o.enabled&&j(e,[o])},destroy:function(){var n=t.rules;return p(o),o.destroyed=!0,n.splice(n.indexOf(o),1),0===n.length&&S(e,t),this}}},P=function(n){n&&n("core","automove",W)};return"undefined"!=typeof cytoscape&&P(cytoscape),n(P)}));
